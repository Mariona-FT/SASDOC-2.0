{% extends 'base-template/base.html' %}

{% block title %}Informació assignació docent{% endblock %}

{% block content %}
<div class="container-fluid d-flex" style="min-height: 100vh;">
    <div class="col-lg-10 mx-auto">
        <h2 style="text-align:center">Assignació docent del professor</h2>
        <h2 style="text-align:center"> {{professor.name }} {{ professor.family_name }}</h2>


        <!-- Display success, warning, or error messages -->
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="{% if message.tags %}alert alert-{{ message.tags }}{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <hr>

        <div class="row">
            <div class="col-lg-11">
              
                <!-- Filter Fields -->
                <h3>Filtrar per curs</h3>
                <div class="d-flex justify-content-between row mb-2">
                
                    <!-- Year Filter Form -->
                <form method="get" id="year-filter-form">
                    <label for="year-select">Selecciona un curs acadèmic</label>
                    <select name="year" id="year-select" class="form-select" onchange="document.getElementById('year-filter-form').submit();">
                        {% for year in available_years %}
                            <!-- Use idYear as the value to send the ID, but display Year in the option text -->
                            <option value="{{ year.idYear }}" {% if year == selected_year %}selected{% endif %}>
                                {{ year.Year }}
                            </option>
                        {% endfor %}
                    </select>
                </form>
                <br>
                <hr>

                <!-- List of all courses -->
                {% if selected_year %}
                    <h5 style="text-align:center; color:blue">
                            Assignació docent pel curs acadèmic - 
                        {{ selected_year.Year }} 

                        {% if selected_year.Year != available_years.first.Year %}
                            (Historial)
                        {% endif %}
                    </h5>
                {% endif %}

            <h3>Resum capacitat docent </h3>

                <h5>Punts totals</h5> 
                <table class="table table-striped table-bordered" id="capacitiesTable">
                    <thead class="thead-dark">
                        <tr>
                            <th style="width: 20%;">Punts</th>
                            <th style="width: 20%;">Hores</th>
                            <th style="width: 45%;">Comentari</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for professor in professor_data %}
                            {% for capacity in professor.capacities %}
                                <tr>
                                    <td>{{ capacity.Points }}</td>
                                    <td>{{ capacity.Points }} x hores</td>
                                    <td>{{ capacity.Comment }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="3" class="text-center" style="font-style: italic;">Sense punts totals pel curs acadèmic seleccionat.</td>
                                </tr>
                            {% endfor %}
                        {% empty %}
                            <tr>
                                <td colspan="3" class="text-center" style="font-style: italic;">Cap informació disponible.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <br>

                <h5>Punts d'alliberació</h5>
                <table class="table table-striped table-bordered" id="freesTable">
                    <thead class="thead-dark">
                        <tr>
                            <th style="width: 20%;">Punts</th>
                            <th style="width:180px">Hores</th>
                            <th style="width: 45%;">Comentari</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        {% for professor in professor_data %}
                            {% for free in professor.frees %}
                                <tr>
                                    <td>{{ free.PointsFree }}</td>
                                    <td> {{ free.PointsFree }} x hores </td>
                                    <td>{{ free.Comment }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="3" class="text-center " style="font-style: italic;">Sense punts d'alliberació pel curs acadèmic seleccionat.</td>
                                </tr>
                            {% endfor %}
                        {% empty %}
                            <tr>
                                <td colspan="3" class="text-center" style="font-style: italic;">Cap informació disponible.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <br>

                <h5> Punts per seccions</h5>
                    <table class="table table-striped table-bordered" id="capacitySectionsTable">
                        <thead class="thead-dark">
                            <tr>
                                <th style="width: 10%;">Punts</th> 
                                <th style="width: 10%;">Hores</th>                                                       
                                <th style="width: 15%;">Secció</th>
                                <th style="width: 35%;">Comentari</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for professor in professor_data %}
                                {% for capacity_section in professor.capacity_sections %}
                                <tr>
                                    <td>{{ capacity_section.Points }}</td>
                                    <td>Hores</td>
                                    <td>{{ capacity_section.Section.NameSection }}</td>
                                    <td>{{ capacity_section.Comment }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center" style="font-style: italic;">Sense punts per seccions pel curs acadèmic seleccionat.</td>
                                </tr>
                                {% endfor %}
                            {% empty %}
                            <tr>
                                <td colspan="3" class="text-center" style="font-style: italic;">Cap informació disponible.</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    

                <h3>Assignació docent per seccions</h3>

                    <table class="table table-striped" id="coursesyear-table">
                        <thead>
                            <tr>
                                <th>Section</th>
                                <th>School</th>
                                <th>Degree</th>
                                <th>Course</th>
                                <th>Total Points</th>
                                <th>Coordinator</th>
                                <th>Coworkers</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% if sections_info %}
                            {% for section in sections_info %}
                            <tr>
                                <td>{{ section.section}} </td>
                                <td>{{ section.school }}</td>
                                <td>{{ section.degree }}</td>
                                <td>{{ section.course }} ({{ section.semester }})</td>
                                <td>{{ section.total_points }}</td>
                                <td>
                                    {% if section.coordinator %}
                                        {{ section.coordinator.name }} {{ section.coordinator.family_name }}
                                        {% else %}
                                        No assignat
                                    {% endif %}
                                </td>
                                <td>
                                    {% for coworker in section.coworkers %}
                                    {{ coworker.name }} {{ coworker.family_name }}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="7" class="text-center">Cap encàrrec docent pel curs acadèmic seleccionat.</td>
                            </tr>        
                        {% endif %}
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
</div>

{% endblock %}
